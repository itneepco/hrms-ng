<mat-toolbar color="primary" id="header">
  <div fxFlex>Training Details</div>
  <div class="flex-spacer"></div>
  <button mat-icon-button mat-dialog-close>
    <mat-icon>close</mat-icon>
  </button>
</mat-toolbar>

<div id="container">
  <mat-accordion>
    <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)">
      <mat-expansion-panel-header>
        <mat-panel-title>Training Info</mat-panel-title>
        <mat-panel-description>Course title, objective and other details</mat-panel-description>
      </mat-expansion-panel-header>
  
      <div>
        <div class="info" fxFlex>
          <span class="title">Course Title: </span>
          {{ training.course_title }}
        </div>
      
        <div class="info" fxFlex>
          <span class="title">Objective: </span>
          {{ training.objective }}
        </div>
      
        <div fxLayout="row" fxLayoutGap="20px">
          <div class="info" fxFlex>
            <span class="title">From Date: </span>
            {{ training.from_date | date:'mediumDate' }} 
          </div>
          <div class="info" fxFlex>
            <span class="title">To Date: </span>
            {{ training.to_date | date:'mediumDate' }}
          </div>
        </div>
      
        <div fxLayout="row" fxLayoutGap="20px">
          <div class="info" fxFlex>
            <span class="title">Training Type: </span>
            {{ trainingService.getType(training.training_type) }} 
          </div>
          <div class="info" fxFlex>
            <span class="title">Venue: </span>
            {{ training.venue }}
          </div>
        </div>
      
        <div fxLayout="row">
          <div class="info" fxFlex>
            <span class="title">Training Order: </span>
            {{ training.training_order_name }}
          </div>
        </div>  
      </div>
    </mat-expansion-panel>
  
    <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)" *ngIf="topics.data && topics.data.length > 0">
      <mat-expansion-panel-header>
        <mat-panel-title>Session Topics</mat-panel-title>
        <mat-panel-description>Details of training topics</mat-panel-description>
      </mat-expansion-panel-header>
      
      <div id="topics">
        <mat-table [dataSource]="topics">
          <ng-container matColumnDef="sl">
            <mat-header-cell *matHeaderCellDef fxFlex="15"> Sl. No </mat-header-cell>
            <mat-cell *matCellDef="let topic; let i=index" fxFlex="15"> 
              {{ i + 1 }} 
            </mat-cell>
          </ng-container>
      
          <ng-container matColumnDef="topic">
            <mat-header-cell *matHeaderCellDef fxFlex="30"> Topic Name </mat-header-cell>
            <mat-cell *matCellDef="let topic" fxFlex="30"> {{topic.topic_name}} </mat-cell>
          </ng-container>
      
          <ng-container matColumnDef="faculty">
            <mat-header-cell *matHeaderCellDef fxFlex="30"> Faculty Name </mat-header-cell>
            <mat-cell *matCellDef="let topic" fxFlex="30"> {{topic.faculty_name}} </mat-cell>
          </ng-container>

          <ng-container matColumnDef="rating">
            <mat-header-cell *matHeaderCellDef fxFlex="15"> 
              <span *ngIf="isAdminPage">Avg. Rating</span>
              <span *ngIf="!isAdminPage">Rating</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let topic" fxFlex="15">
              <span *ngIf="topic.avg_rating">{{ topic.avg_rating | number:'1.1'}} / 5.0</span>
              <span *ngIf="topic.rating">{{ topic.rating | number:'1.1'}} / 5.0</span>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="topicColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: topicColumns;"></mat-row>
        </mat-table>
      </div>
    </mat-expansion-panel>
  
    <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)" *ngIf="participants.data">
      <mat-expansion-panel-header>
        <mat-panel-title>Participants</mat-panel-title>
        <mat-panel-description>Details of training participants</mat-panel-description>
      </mat-expansion-panel-header>
      
      <div id="participants">
        <mat-table [dataSource]="participants" *ngIf="participants.data.length > 0">
          <ng-container matColumnDef="mark" *ngIf="isAdminPage">
            <mat-header-cell *matHeaderCellDef fxFlex="10"> Mark </mat-header-cell>
            <mat-cell *matCellDef="let participant; let i=index" fxFlex="10"> 
              <mat-checkbox (change)="markParticipant($event, participant)" [checked]="participant.present"></mat-checkbox>
            </mat-cell>
          </ng-container>
          
          <ng-container matColumnDef="sl" *ngIf="!isProfilePage">
            <mat-header-cell *matHeaderCellDef fxFlex="10"> Sl. </mat-header-cell>
            <mat-cell *matCellDef="let participant; let i=index" fxFlex="10"> 
              {{ i + 1 }} 
            </mat-cell>
          </ng-container>
      
          <ng-container matColumnDef="emp_code">
            <mat-header-cell *matHeaderCellDef fxFlex="15"> Emp Code </mat-header-cell>
            <mat-cell *matCellDef="let participant" fxFlex="15"> {{participant.emp_code}} </mat-cell>
          </ng-container>
      
          <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef fxFlex="28"> Full Name </mat-header-cell>
            <mat-cell *matCellDef="let participant" fxFlex="28"> {{participant.name | titlecase}} </mat-cell>
          </ng-container>
      
          <ng-container matColumnDef="designation">
            <mat-header-cell *matHeaderCellDef fxFlex="27"> Designation </mat-header-cell>
            <mat-cell *matCellDef="let participant" fxFlex="27"> {{participant.designation}} </mat-cell>
          </ng-container>
      
          <ng-container matColumnDef="grade" *ngIf="isProfilePage">
            <mat-header-cell *matHeaderCellDef fxFlex="8"> Grade </mat-header-cell>
            <mat-cell *matCellDef="let participant" fxFlex="8"> {{participant.grade}} </mat-cell>
          </ng-container>

          <ng-container matColumnDef="project">
            <mat-header-cell *matHeaderCellDef fxFlex="12"> Project </mat-header-cell>
            <mat-cell *matCellDef="let participant" fxFlex="12"> {{participant.project}} </mat-cell>
          </ng-container>

          <ng-container matColumnDef="attendance">
            <mat-header-cell *matHeaderCellDef fxFlex="12"> Attendance </mat-header-cell>
            <mat-cell *matCellDef="let participant" fxFlex="12"> {{getAttendance(participant)}} </mat-cell>
          </ng-container>
      
          <mat-header-row *matHeaderRowDef="participantColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: participantColumns;"></mat-row>
        </mat-table>

        <ng-container *ngIf="isAdminPage && 
            (training.status == training_published || training.status == training_completed)">
          <button mat-raised-button color="primary" (click)="markAsPresent()" class="btn"
            [disabled]="attendance.length < 1">Save Attendance</button>

          <button mat-raised-button color="primary" (click)="markTrainingCompleted()" class="btn"
            *ngIf="training.status != training_completed">Mark Training Completed</button>  
        </ng-container>
      </div>
    </mat-expansion-panel>
  
    <mat-expansion-panel [expanded]="step === 3" (opened)="setStep(3)" *ngIf="(feedback && feedbacks.length > 0)">
      <mat-expansion-panel-header>
        <mat-panel-title>Feedbacks</mat-panel-title>
        <mat-panel-description>Feedback on the training programme</mat-panel-description>
      </mat-expansion-panel-header>
      
      <div>
        <div fxLayout="row" fxLayoutAlign="start center">
          <div fxFlex="40">Course Duration</div>
          <div fxFlex="60">
            <div fxLayout="row" fxLayoutAlign="start center">
              <div class="rating">
                <span *ngIf="isAdminPage">{{averageRating.duration | number:'1.1'}}</span>
                <span>/ 5.0</span></div>
              <div>&nbsp;<mat-icon>star</mat-icon></div>
            </div>
          </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center">
          <div fxFlex="40">Course material</div>
          <div fxFlex="60">
            <div fxLayout="row" fxLayoutAlign="start center">
              <div class="rating">{{averageRating.content | number:'1.1'}} / 5.0</div>
              <div>&nbsp;<mat-icon>star</mat-icon></div>
            </div>
          </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center">
          <div fxFlex="40">Training Methodology</div>
          <div fxFlex="60">
            <div fxLayout="row" fxLayoutAlign="start center">
              <div class="rating">{{averageRating.methodology | number:'1.1'}} / 5.0</div>
              <div>&nbsp;<mat-icon>star</mat-icon></div>
            </div>
          </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center">
          <div fxFlex="40">Administrative Service</div>
          <div fxFlex="60">
            <div fxLayout="row" fxLayoutAlign="start center">
              <div class="rating">{{averageRating.admin_service | number:'1.1'}} / 5.0</div>
              <div>&nbsp;<mat-icon>star</mat-icon></div>
            </div>
          </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center">
          <div fxFlex="40">Overall Utility</div>
          <div fxFlex="60">
            <div fxLayout="row" fxLayoutAlign="start center">
              <div class="rating">{{averageRating.overall_utility | number:'1.1'}} / 5.0</div>
              <div>&nbsp;<mat-icon>star</mat-icon></div>
            </div>
          </div>
        </div>
      </div>

      <mat-divider class="divider"></mat-divider>

      <mat-list>
        <mat-list-item *ngFor="let feedback of feedbacks">
          <h3 matLine class="comment"> {{ feedback.comments }} </h3>
          <div matLine fxLayoutAlign="space-between center">  
            <div class="author"> -- by {{ getEmployeeDetail(feedback) }} </div>
            <div fxLayout="row" fxLayoutAlign="start center">
              <div class="rating">{{ calculateRating(feedback) | number:'1.1' }} / 5.0</div>
              <div>&nbsp;<mat-icon>star</mat-icon></div>
            </div>
          </div>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>
  </mat-accordion>
</div>

<mat-dialog-actions align="end" id="close-button">
  <button mat-button color="primary" type="button" mat-dialog-close>Close</button>
</mat-dialog-actions>
