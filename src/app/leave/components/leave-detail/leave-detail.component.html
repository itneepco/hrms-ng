<div fxLayoutAlign="space-between" id="header">
  <h3 mat-dialog-title>Leave Details</h3>
  <button mat-icon-button mat-dialog-close>
    <mat-icon>close</mat-icon>
  </button>
</div>

<div fxLayout="column" fxLayoutAlign="end stretch" id="container">
  <div fxFlex>
    <mat-accordion>
      <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            General Info
          </mat-panel-title>
          <mat-panel-description>
            Purpose, address and contact during leave
          </mat-panel-description>
        </mat-expansion-panel-header>
  
        <div fxLayout="row" fxLayoutGap="20px">
          <div class="info" fxFlex>
            <span class="title">Emp Name: </span>
            {{data.leave.first_name | titlecase}} 
            {{data.leave.last_name | titlecase}}</div>
          <div class="info" fxFlex>
            <span class="title">Contact: </span>
            {{data.leave.contact_no}}</div>
        </div>

        <div fxLayout="row" fxLayoutGap="20px">
          <div class="info" fxFlex>
            <span class="title">Prefix from: </span>
            {{data.leave.prefix_from | date:'mediumDate'}}</div>
          <div class="info" fxFlex>
            <span class="title">Prefix to: </span>
            {{data.leave.prefix_to | date:'mediumDate'}}</div>
        </div>

        <div fxLayout="row" fxLayoutGap="20px">
          <div class="info" fxFlex>
            <span class="title">Suffix from: </span>
            {{data.leave.suffix_from | date:'mediumDate'}}</div>
          <div class="info" fxFlex>
            <span class="title">Suffix to: </span>
            {{data.leave.suffix_to | date:'mediumDate'}}</div>
        </div>

        <div class="info" fxFlex>
          <span class="title">Purpose: </span>
          {{data.leave.purpose}}
        </div>
        <div class="info" fxFlex>
          <span class="title">Address: </span>
          {{data.leave.address}}
        </div>
      </mat-expansion-panel>

      <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Leave Info  
          </mat-panel-title>
          <mat-panel-description>
            Details of leave types and no of days 
          </mat-panel-description>
        </mat-expansion-panel-header>
        
        <div *ngIf="leaveDetailSource" style="padding-top: 8px" id="leaveDay">
          <mat-table [dataSource]="leaveDetailSource">
            <ng-container matColumnDef="position">
              <mat-header-cell *matHeaderCellDef fxFlex="15"> Sl. No. </mat-header-cell>
              <mat-cell *matCellDef="let leaveDay; let i = index;" fxFlex="15"> 
                {{ i + 1 }} 
              </mat-cell>
            </ng-container>

            <ng-container matColumnDef="leave_type">
              <mat-header-cell *matHeaderCellDef fxFlex="30"> Leave Type </mat-header-cell>
              <mat-cell *matCellDef="let leaveDay" fxFlex="30"> 
                {{lTypeService.getLeaveType(leaveDay.leave_type)}} 
              </mat-cell>
            </ng-container>

            <ng-container matColumnDef="station_leave">
              <mat-header-cell *matHeaderCellDef fxFlex="15"> Station Leave </mat-header-cell>
              <mat-cell *matCellDef="let leaveDay" fxFlex="15"> 
                {{ leaveDay.station_leave ? "YES": "NO" }} 
              </mat-cell>
            </ng-container>
        
            <ng-container matColumnDef="from_date">
              <mat-header-cell *matHeaderCellDef fxFlex="20"> From Date </mat-header-cell>
              <mat-cell *matCellDef="let leaveDay" fxFlex="20"> {{leaveDay.from_date | date:'mediumDate'}} </mat-cell>
            </ng-container>
        
            <ng-container matColumnDef="to_date">
              <mat-header-cell *matHeaderCellDef fxFlex="20"> To Date </mat-header-cell>
              <mat-cell *matCellDef="let leaveDay" fxFlex="20"> 
                <span *ngIf="!(leaveDay.leave_type == cl_code || leaveDay.leave_type == rh_code)">
                  {{leaveDay.to_date | date:'mediumDate'}}
                </span> 
              </mat-cell>
            </ng-container>
        
            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
          </mat-table>
        </div>  
      </mat-expansion-panel>

      <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            History Info  
          </mat-panel-title>
          <mat-panel-description>
            Details of leave approval history
          </mat-panel-description>
        </mat-expansion-panel-header>
        
        <mat-list>
          <mat-list-item *ngFor="let hist_info of data.leave.history; let i=index">
            <h3 matLine> 
              <span>{{i + 1}}.&nbsp;</span>
              <span>{{wActionService.getWorkflowAction(hist_info.workflow_action)}}</span>
              <span>&nbsp;on&nbsp;</span>
              <span>{{hist_info.updated_at | date:'mediumDate'}}</span> 
            </h3>
            <p matLine>
              <span *ngIf="hist_info.officer">&nbsp;&nbsp;&nbsp;&nbsp; -- by {{hist_info.officer.first_name | titlecase}} {{hist_info.officer.last_name | titlecase}} </span>
            </p>
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>

      <mat-expansion-panel [expanded]="step === 3" (opened)="setStep(3)"
          *ngIf="!((data.leave.status == leave_approved_code || data.leave.status == leave_callback_code) && 
          (data.pageNo == transactionPage || data.pageNo == leaveProcessedPage))">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Actions 
          </mat-panel-title>
          <mat-panel-description>
            Actions to be performed by officer
          </mat-panel-description>
        </mat-expansion-panel-header>
        
        <form [formGroup]="actionForm" 
          fxLayout="column" 
          (ngSubmit)="onSubmit()">
          
          <mat-form-field>
            <mat-select placeholder="Select required action" formControlName="workflow_action">
              <mat-option *ngFor="let action of actions" [value]="action.code">
                {{action.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field *ngIf="workflow_action.value == leave_recommended_code">
            <mat-select placeholder="Forward to" formControlName="addressee_emp_code">
              <mat-option *ngFor="let officer of ctrlOfficers" [value]="officer.emp_code"> 
                {{officer.first_name | titlecase}} {{officer.last_name | titlecase}}, {{officer.designation}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <input matInput placeholder="Remarks" formControlName="remarks">
          </mat-form-field>

          <div fxLayoutAlign="end start">
            <button mat-raised-button color="primary" [disabled]="actionForm.invalid">Submit</button>
          </div>  
        </form>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>